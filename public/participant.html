<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LiveKit Participant â€¢ My Room</title>
  <meta name="description" content="LiveKit video participant view">

  <style>
    :root {
      --bg: #111;
      --text: #eee;
      --accent: #00aaff;
      --border: #444;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      box-sizing: border-box;
    }

    h2 {
      color: var(--accent);
      margin: 0 0 30px;
      font-size: 1.8rem;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      align-items: start;
    }

    video {
      width: 100%;
      height: auto;
      max-height: 80vh;
      background: #000;
      border: 3px solid var(--border);
      border-radius: 12px;
      object-fit: contain; /* Preserves aspect ratio, shows full picture */
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.6);
    }

    .video-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .label {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      pointer-events: none;
      z-index: 10;
    }

    .controls {
      margin-top: 30px;
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover { background: #0088cc; }
    button:disabled { background: #555; cursor: not-allowed; }

    .status {
      margin-top: 20px;
      font-size: 0.9rem;
      color: #aaa;
    }

    /* Mobile: stack videos */
    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
      video { max-height: 60vh; }
    }

    @media (max-width: 600px) {
      body { padding: 10px; }
      h2 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
<h2>Participant Room</h2>

<div class="container">
  <!-- Local Video (Participant's own camera) -->
  <div class="video-wrapper">
    <div class="label">You</div>
    <video id="local-video" autoplay muted playsinline></video>
  </div>

  <!-- Remote Video (Host) -->
  <div class="video-wrapper">
    <div class="label">Host</div>
    <video id="remote-video" autoplay playsinline></video>
  </div>
</div>

<div class="controls">
  <button id="fullscreen-btn">Full Screen</button>
  <button id="pip-btn">Picture in Picture</button>
</div>

<div class="status" id="status">Connecting...</div>

<!-- LiveKit Client SDK -->
<script src="https://cdn.jsdelivr.net/npm/livekit-client/dist/livekit-client.umd.min.js"></script>
<script src="participant.js"></script>

<script>
  // Fullscreen button
  document.getElementById('fullscreen-btn').onclick = () => {
    const container = document.querySelector('.container');
    if (container.requestFullscreen) {
      container.requestFullscreen();
    } else if (container.webkitRequestFullscreen) {
      container.webkitRequestFullscreen();
    } else if (container.msRequestFullscreen) {
      container.msRequestFullscreen();
    }
  };

  // Picture-in-Picture (for remote video)
  document.getElementById('pip-btn').onclick = async () => {
    const video = document.getElementById('remote-video');
    if (video && document.pictureInPictureEnabled && !video.disablePictureInPicture) {
      try {
        if (document.pictureInPictureElement) {
          await document.exitPictureInPicture();
        } else {
          await video.requestPictureInPicture();
        }
      } catch (err) {
        alert("PiP not supported or video not ready");
      }
    }
  };

  // Optional: Update status when connected
  // You can enhance participant.js to call: window.updateStatus("Connected")
  window.updateStatus = (msg) => {
    document.getElementById('status').textContent = msg;
  };
</script>
</body>
</html>